---
title: Difference Array
date: 2022-02-05 15:49:12
categories:
  - - 计算机
mathjax: true
tags:
  - CX
---

**差分数组（Difference Array）** 是原数组中相邻元素两两作差（右边减左边）得到的。准确来说，对于数组 `a`，定义其差分数组 `d` 为：

```javascript
d[i] = i === 0 ? a[0] : a[i] - a[i - 1]
```

差分数组有两个性质，以 `a = [1,3,3,5,8]` 和 `d = [1,2,0,2,3]` 来举例说明：

**性质 1：从左到右累加 `d` 中的元素，可以得到数组 `a`。** 这是显然的。

**性质 2：区间操作与单点操作可以相互转换：**

- **区间操作：** 把 `a` 中的子数组 `a[i]` 到 `a[j]` 都加上 `x`；
- **单点操作：** 把 `d[i]` 增加 `x`、`d[j + 1]` 减少 `x`。如果 `j + 1 == n`，则只需要把 `d[i]` 增加 `x`。

对性质 2 进行举例说明，假设我们现在要将 `a[1]` 到 `a[3]` 都增加 `10`：

- 直接对 `a` 进行区间操作得到的结果是 `[1,13,13,15,8]`；
- 对差分数组 `d` 进行单点操作得到的结果是 `[1,12,0,2,-7]`，将其按照性质 1还原，得到 `[1,13,13,15,8]`。

再举一个例子，如果我们要将 `a[0]` 到 `a[3]` 都增加 `10`，那么单点操作的结果是 `[11,2,0,2,-7]`，可以还原为 `[11,13,13,15,8]`。

最后举一个例子，如果我们将 `a[1]` 到 `a[4]` 都增加 `10`，那么单点操作的结果是 `[1,12,0,2,3]`，可以还原为 `[1,13,13,15,18]`。

下面是利用差分数组在将区间操作 `O(m*n)` 的时间复杂度优化为 `O(n)` 的代码模板：

```typescript
function rangeOperations(a, operations) {
  // 构建差分数组
  const diff = new Array(a.length)
  for (let i = 0; i < a.length; i++) {
    diff[i] = i === 0 ? a[i] : a[i] - a[i - 1]
  }
  // 对差分数组进行单点操作
  for (const [left, right, x] of operations) {
    diff[left] += x
    if (right + 1 < n) {
      diff[right + 1] -= x
    }
  }
  // 还原数组
  for (let i = 0; i < n; i++) {
    diff[i] += diff[i - 1]
  }
  return diff
}
```
