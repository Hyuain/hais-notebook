<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/hais-notebook/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/hais-notebook/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/hais-notebook/images/favicon-16x16.png">

<link rel="stylesheet" href="/hais-notebook/css/main.css">


<link rel="stylesheet" href="/hais-notebook/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://hyuain.github.io/hais-notebook').hostname,
    root: '/hais-notebook/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: 'W0QZQNNH7N',
      apiKey: '00189c8d102508ea71e94422b5f129fd',
      indexName: 'hais-notebook',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="关于原生 JavaScript 的一些问题与答案。">
<meta property="og:type" content="article">
<meta property="og:title" content="FAQs：原生 JavaScript">
<meta property="og:url" content="https://hyuain.github.io/hais-notebook/2020/02/04/Others-QA-JS/index.html">
<meta property="og:site_name" content="Hais Notebook">
<meta property="og:description" content="关于原生 JavaScript 的一些问题与答案。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2019/11/23/16e96b8587ad911d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="article:published_time" content="2020-02-04T10:30:50.000Z">
<meta property="article:modified_time" content="2021-05-13T03:48:43.689Z">
<meta property="article:author" content="Harvey Zhang">
<meta property="article:tag" content="入门">
<meta property="article:tag" content="FAQ">
<meta property="article:tag" content="收集">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-gold-cdn.xitu.io/2019/11/23/16e96b8587ad911d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">

<link rel="canonical" href="https://hyuain.github.io/hais-notebook/2020/02/04/Others-QA-JS/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>FAQs：原生 JavaScript | Hais Notebook</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/hais-notebook/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hais Notebook</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/hais-notebook/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/hais-notebook/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/hais-notebook/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/hais-notebook/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hyuain.github.io/hais-notebook/2020/02/04/Others-QA-JS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/hais-notebook/images/avatar.gif">
      <meta itemprop="name" content="Harvey Zhang">
      <meta itemprop="description" content="小海的笔记本">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hais Notebook">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          FAQs：原生 JavaScript
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-04 10:30:50" itemprop="dateCreated datePublished" datetime="2020-02-04T10:30:50+00:00">2020-02-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-13 03:48:43" itemprop="dateModified" datetime="2021-05-13T03:48:43+00:00">2021-05-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hais-notebook/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/hais-notebook/categories/%E5%89%8D%E7%AB%AF/%E5%85%B6%E4%BB%96/" itemprop="url" rel="index">
                    <span itemprop="name">其他</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>关于原生 JavaScript 的一些问题与答案。</p>
<a id="more"></a>
<h1 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h1><h2 id="Promise-如何消灭回调地狱"><a href="#Promise-如何消灭回调地狱" class="headerlink" title="Promise 如何消灭回调地狱"></a>Promise 如何消灭回调地狱</h2><p>回调地狱：</p>
<ol>
<li>多层嵌套</li>
<li>无法方便地进行错误处理</li>
</ol>
<p>解决办法：</p>
<ol>
<li>回调函数延迟绑定，回调函数是通过后面的 then 方法传入的</li>
<li>返回值穿透，根据 then 中回调函数的传入值创建不同类型的 Promise，再把返回的 Promise 穿透到外层，以供后续使用。以上两点实现了链式调用，解决多层嵌套问题</li>
<li>错误冒泡，前面产生的错误会一直向后传递，被 catch 接收到，就不用频繁地检查错误了</li>
</ol>
<h2 id="Promise-怎样实现链式调用的"><a href="#Promise-怎样实现链式调用的" class="headerlink" title="Promise 怎样实现链式调用的"></a>Promise 怎样实现链式调用的</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PENDING = <span class="string">'pending'</span></span><br><span class="line"><span class="keyword">const</span> FULFILLED = <span class="string">'fulfilled'</span></span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">'rejected'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyPromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 缓存当前 Promise 实例</span></span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span></span><br><span class="line">  self.value = <span class="literal">null</span></span><br><span class="line">  self.error = <span class="literal">null</span></span><br><span class="line">  self.status = PENDING</span><br><span class="line">  <span class="comment">// 回调函数有可能是个数组</span></span><br><span class="line">  self.onFulfilledCallbacks = []</span><br><span class="line">  self.onRejectedCallbacks = []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> resolve = <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (self.status !== PENDING) <span class="keyword">return</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      self.status = FULFILLED</span><br><span class="line">      self.value = value</span><br><span class="line">      self.onFulfilledCallbacks.forEach(<span class="function"><span class="params">callback</span> =&gt;</span> callback(self.value))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> reject = <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (self.status !== PENDING) <span class="keyword">return</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      self.status = REJECTED</span><br><span class="line">      self.error = error</span><br><span class="line">      self.onRejectedCallbacks.forEach(<span class="function"><span class="params">callback</span> =&gt;</span> callback(self.error))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  executor(resolve, reject)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyPromise.prototype.then = <span class="function"><span class="keyword">function</span>(<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> self = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">let</span> bridgePromise</span><br><span class="line">  onFulfilled = <span class="keyword">typeof</span> onFulfilled === <span class="string">'function'</span> ? onFulfilled : <span class="function"><span class="params">value</span> =&gt;</span> value</span><br><span class="line">  onRejected = <span class="keyword">typeof</span> onRejected === <span class="string">'function'</span> ? onRejected : <span class="function"><span class="params">error</span> =&gt;</span> &#123; <span class="keyword">throw</span> error &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolvePromise</span>(<span class="params">bridgePromise, x, resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x <span class="keyword">instanceof</span> MyPromise) &#123;</span><br><span class="line">      <span class="comment">// 拆解这个 promise，直到返回值不为 promise 为止</span></span><br><span class="line">      <span class="keyword">if</span> (x.status === PENDING) &#123;</span><br><span class="line">        x.then(<span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">          resolvePromise(bridgePromise, y, resolve, reject)</span><br><span class="line">        &#125;, error =&gt; &#123;</span><br><span class="line">          reject(error)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      resolve(x)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (self.status === PENDING) &#123;</span><br><span class="line">    <span class="keyword">return</span> bridgePromise =  <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      self.onFulfilledCallbacks.push(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 要拿到 then 中回调返回的结果</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> x = onFulfilled(value)</span><br><span class="line">          resolvePromise(bridgePromise, x, resolve, reject)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          reject(e)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      self.onRejectedCallbacks.push(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          reject(onRejected(error))</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          reject(e)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (self.status === FULFILLED) &#123;</span><br><span class="line">    <span class="keyword">return</span> bridgePromise = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> x = onFulfilled(self.value)</span><br><span class="line">          resolvePromise(bridgePromise, x, resolve, reject)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          reject(e)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> bridgePromise = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> x = onRejected(self.error)</span><br><span class="line">          resolvePromise(bridgePromise, x, resolve, reject)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          reject(e)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyPromise.prototype.catch = <span class="function"><span class="keyword">function</span> (<span class="params">onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.then(<span class="literal">null</span>, onRejected)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="前端路由"><a href="#前端路由" class="headerlink" title="前端路由"></a>前端路由</h1><blockquote>
<p>路由就是根据不同的 URL 来展示不同的内容或页面</p>
</blockquote>
<p>用户每次提交表单就要重新刷新页面 -&gt; 催生了 AJAX；<br>用户在多页面之间跳转体验很差 -&gt; 催生了单页应用（SPA, Single-Page Application）<br>单页应用页面本身的 URL 没有变化，导致其无法记住用户的操作，对 SEO 也不友好 -&gt; 催生了前端路由</p>
<blockquote>
<p>前端路由就是在 <strong>保证只有一个 HTML 页面</strong>，且与用户交互时不刷新和跳转页面的同时，为 SPA 中的每个视图展示形式匹配一个 <strong>特殊的 URL</strong><br>在刷新、前进、后退和 SEO 时均通过这个特殊的 URL 来实现<br>并且改变 URL 时不向服务器发送请求</p>
</blockquote>
<h2 id="Hash-与-History"><a href="#Hash-与-History" class="headerlink" title="Hash 与 History"></a>Hash 与 History</h2><h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><p>由于 hash 值的变化不会导致浏览器像服务器发送请求，而且 hash 的改变会触发 <code>hashchange</code> 事件，浏览器的前进后退也能对其进行控制，所以在 H5 的 history 模式出现之前，基本都是使用 hash 模式来实现前端路由。</p>
<h4 id="基本-API"><a href="#基本-API" class="headerlink" title="基本 API"></a>基本 API</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.location.hash = <span class="string">'string'</span> <span class="comment">// 用于设置 hash 值</span></span><br><span class="line"><span class="keyword">let</span> hash = <span class="built_in">window</span>.location.hash <span class="comment">// 获取当前 hash 值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听 hash 变化，点击浏览器的前进后退会触发：</span></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'hashchange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> newURL = event.newURL <span class="comment">// hash 改变后的新 URL</span></span><br><span class="line">  <span class="keyword">let</span> oldURL = event.oldURL <span class="comment">// hash 改变前的旧 URL</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以简写成</span></span><br><span class="line"><span class="built_in">window</span>.onhashchange(<span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="实现一个路由对象"><a href="#实现一个路由对象" class="headerlink" title="实现一个路由对象"></a>实现一个路由对象</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hashRouter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="comment">// 存储不同的 hash 值对应的回调函数</span></span><br><span class="line">    <span class="keyword">this</span>.routers = &#123;&#125;</span><br><span class="line">    <span class="comment">// 通过 hashchange 来监听 hash 变化</span></span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'hashchange'</span>, <span class="keyword">this</span>.load.bind(<span class="keyword">this</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 注册每个视图（注册每个 hash 值对应的回调函数）</span></span><br><span class="line">  register(hash, callback = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;) &#123;</span><br><span class="line">    <span class="keyword">this</span>.routers[hash] = callback</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 注册首页的回调（没有 hash 值时默认为首页）</span></span><br><span class="line">  registerIndex(callback = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;) &#123;</span><br><span class="line">    <span class="keyword">this</span>.routers[<span class="string">'index'</span>] = callback</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 处理视图未找到的情况</span></span><br><span class="line">  registerNotFound(callback = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;) &#123;</span><br><span class="line">    <span class="keyword">this</span>.routers[<span class="string">'404'</span>] = callback</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 处理异常情况</span></span><br><span class="line">  registerError(callback = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;) &#123;</span><br><span class="line">    <span class="keyword">this</span>.routers[<span class="string">'error'</span>] = callback</span><br><span class="line">  &#125;</span><br><span class="line">  load() &#123;</span><br><span class="line">    <span class="keyword">let</span> hash = location.hash.slice(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">let</span> handler</span><br><span class="line">      <span class="comment">// 没有 hash 默认首页</span></span><br><span class="line">    <span class="keyword">if</span> (!hash) &#123;</span><br><span class="line">      handler = <span class="keyword">this</span>.routers.index</span><br><span class="line">      <span class="comment">// 没找到对应的 hash 值</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">this</span>.routers.hasOwnProperty(hash)) &#123;</span><br><span class="line">      handler = <span class="keyword">this</span>.routers[<span class="string">'404'</span>] || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">      <span class="comment">// 其他普通情况</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      handler = <span class="keyword">this</span>.routers[hash]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 执行注册的回调函数</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      handler.call(<span class="keyword">this</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(e)</span><br><span class="line">      (<span class="keyword">this</span>.routers[<span class="string">'error'</span>] || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;).call(<span class="keyword">this</span>, e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后再这样使用：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"nav"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/page1"</span>&gt;</span>page1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/page2"</span>&gt;</span>page2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/page3"</span>&gt;</span>page3<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/page4"</span>&gt;</span>page4<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/page5"</span>&gt;</span>page5<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> router = <span class="keyword">new</span> HashRouter()</span><br><span class="line"><span class="keyword">let</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册首页回调函数</span></span><br><span class="line">router.registerIndex(<span class="function"><span class="params">()</span> =&gt;</span> container.innerHTML = <span class="string">'我是首页'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册其他视图回调函数</span></span><br><span class="line">router.register(<span class="string">'/page1'</span>, () =&gt; container.innerHTML = <span class="string">'我是 page1'</span>)</span><br><span class="line">router.register(<span class="string">'/page2'</span>, () =&gt; container.innerHTML = <span class="string">'我是 page2'</span>)</span><br><span class="line">router.register(<span class="string">'/page3'</span>, () =&gt; container.innerHTML = <span class="string">'我是 page3'</span>)</span><br><span class="line">router.register(<span class="string">'/page4'</span>, () =&gt; &#123;<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'抛出一个异常'</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册未找到对应 hash 值时的回调</span></span><br><span class="line">router.regierNotFound(<span class="function"><span class="params">()</span> =&gt;</span> container.innerHTML = <span class="string">'页面未找到'</span>)</span><br><span class="line"><span class="comment">// 注册出现异常时的回调</span></span><br><span class="line">router.registerError(<span class="function">(<span class="params">e</span>) =&gt;</span> container.innerHTML = <span class="string">'页面异常，错误信息：&lt;br&gt;'</span> + e.message)</span><br><span class="line"><span class="comment">// 加载视图</span></span><br><span class="line">router.load()</span><br></pre></td></tr></table></figure>
<h3 id="History"><a href="#History" class="headerlink" title="History"></a>History</h3><p>在 HTML5 之前，浏览器就已经有了 history 对象，但早期的只有 <code>go</code> <code>forward</code> <code>back</code> 这些方法，用于多页面之间的跳转，HTML 5 中新加入了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">history.pushState() <span class="comment">// 添加新的状态到历史状态栈</span></span><br><span class="line">history.replaceState() <span class="comment">// 用新的状态代替当前状态</span></span><br><span class="line">history.state <span class="comment">// 返回当前状态对象</span></span><br></pre></td></tr></table></figure>
<p>与 hash 不同，history 的改变并不会触发任何事件，所以我们无法直接监听 history 的改变而做出相应的改变</p>
<p>而对于单页应用的 history 模式而言，URL 的改变只有可能是以下四种情况：</p>
<ol>
<li>点击浏览器的而前进或后退按钮</li>
<li>点击 a 标签</li>
<li>在 JS 代码中触发 <code>history.pushState</code> 函数</li>
<li>在 JS 代码中触发 <code>history.replaceState</code> 函数</li>
</ol>
<h4 id="实现一个路由对象-1"><a href="#实现一个路由对象-1" class="headerlink" title="实现一个路由对象"></a>实现一个路由对象</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HistoryRouter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="comment">// 存储不同 path 值对应的回调函数</span></span><br><span class="line">    <span class="keyword">this</span>.routers = &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>.listenPopState()</span><br><span class="line">    <span class="keyword">this</span>.listenLink()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 监听 popstate 事件，处理前进和后退时应该如何调用</span></span><br><span class="line">  listenPopState() &#123;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>, (e) =&gt; &#123;</span><br><span class="line">      <span class="keyword">let</span> state = e.state || &#123;&#125;</span><br><span class="line">      <span class="keyword">let</span> path = state.path || <span class="string">''</span></span><br><span class="line">      <span class="keyword">this</span>.dealPathHandler(path)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 监听 a 标签，阻止他的默认事件，并且调用 pushState 方法</span></span><br><span class="line">  listenLink() &#123;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">      <span class="keyword">let</span> dom = e.target</span><br><span class="line">      <span class="keyword">if</span> ((dom.tagName.toLowerCase === <span class="string">'a'</span>) &amp;&amp; dom.getAttribute(<span class="string">'href'</span>)) &#123;</span><br><span class="line">        e.preventDefault()</span><br><span class="line">        <span class="keyword">this</span>.assign(dom.getAttribute(<span class="string">'href'</span>))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 首次进入页面时调用</span></span><br><span class="line">  load() &#123;</span><br><span class="line">    <span class="keyword">let</span> path = location.pathname</span><br><span class="line">    <span class="keyword">this</span>.dealPathHandler(path)</span><br><span class="line">  &#125;</span><br><span class="line">  register(path, callback = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;) &#123;</span><br><span class="line">    <span class="keyword">this</span>.routers[path] = callback</span><br><span class="line">  &#125;</span><br><span class="line">  registerIndex(callback = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;) &#123;</span><br><span class="line">    <span class="keyword">this</span>.routers[<span class="string">'/'</span>] = callback</span><br><span class="line">  &#125;</span><br><span class="line">  registerNotFound(callback = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;) &#123;</span><br><span class="line">    <span class="keyword">this</span>.routers[<span class="string">'404'</span>] = callback</span><br><span class="line">  &#125;</span><br><span class="line">  registerError(callback = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;) &#123;</span><br><span class="line">    <span class="keyword">this</span>.routers[<span class="string">'error'</span>] = callback</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 触发 pushState</span></span><br><span class="line">  assign(path) &#123;</span><br><span class="line">    history.pushState(&#123;path&#125;, <span class="literal">null</span>, path)</span><br><span class="line">    <span class="keyword">this</span>.dealPathHandler(path)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 触发 replaceState</span></span><br><span class="line">  replace(path) &#123;</span><br><span class="line">    history.replaceState(&#123;path&#125;, <span class="literal">null</span>, path)</span><br><span class="line">    <span class="keyword">this</span>.dealPathHandler(path)</span><br><span class="line">  &#125;</span><br><span class="line">  dealPathHandler(path) &#123;</span><br><span class="line">    <span class="keyword">let</span> handler</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">this</span>.routers.hasOwnProperty(path)) &#123;</span><br><span class="line">      handler = <span class="keyword">this</span>.routers[<span class="string">'404'</span>] || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      handler = <span class="keyword">this</span>.routers[path]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      handler.call(<span class="keyword">this</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(e)</span><br><span class="line">      (<span class="keyword">this</span>.routers[<span class="string">'error'</span>] || <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;).call(<span class="keyword">this</span>, e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样的使用方法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"nav"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/page1"</span>&gt;</span>page1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/page2"</span>&gt;</span>page2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/page3"</span>&gt;</span>page3<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/page4"</span>&gt;</span>page4<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/page5"</span>&gt;</span>page5<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn"</span>&gt;</span>page2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> router = <span class="keyword">new</span> HashRouter()</span><br><span class="line"><span class="keyword">let</span> container = <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册首页回调函数</span></span><br><span class="line">router.registerIndex(<span class="function"><span class="params">()</span> =&gt;</span> container.innerHTML = <span class="string">'我是首页'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册其他视图回调函数</span></span><br><span class="line">router.register(<span class="string">'/page1'</span>, () =&gt; container.innerHTML = <span class="string">'我是 page1'</span>)</span><br><span class="line">router.register(<span class="string">'/page2'</span>, () =&gt; container.innerHTML = <span class="string">'我是 page2'</span>)</span><br><span class="line">router.register(<span class="string">'/page3'</span>, () =&gt; container.innerHTML = <span class="string">'我是 page3'</span>)</span><br><span class="line">router.register(<span class="string">'/page4'</span>, () =&gt; &#123;<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'抛出一个异常'</span>)&#125;)</span><br><span class="line"></span><br><span class="line">btn.onclick = <span class="function"><span class="params">()</span> =&gt;</span> router.assign(<span class="string">'/page2'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册未找到对应 path 值时的回调</span></span><br><span class="line">router.regierNotFound(<span class="function"><span class="params">()</span> =&gt;</span> container.innerHTML = <span class="string">'页面未找到'</span>)</span><br><span class="line"><span class="comment">// 注册出现异常时的回调</span></span><br><span class="line">router.registerError(<span class="function">(<span class="params">e</span>) =&gt;</span> container.innerHTML = <span class="string">'页面异常，错误信息：&lt;br&gt;'</span> + e.message)</span><br><span class="line"><span class="comment">// 加载视图</span></span><br><span class="line">router.load()</span><br></pre></td></tr></table></figure>
<h2 id="各自的优缺点及使用场景"><a href="#各自的优缺点及使用场景" class="headerlink" title="各自的优缺点及使用场景"></a>各自的优缺点及使用场景</h2><h3 id="为什么-hash-模式需要服务器端配合？"><a href="#为什么-hash-模式需要服务器端配合？" class="headerlink" title="为什么 hash 模式需要服务器端配合？"></a>为什么 hash 模式需要服务器端配合？</h3><p>我们通过 history 来修改 URL 后，页面不会刷新；如果我们手动刷新页面，或者通过 URL 直接进入应用时，服务端是无法识别这个 URL 的——因为我们其实只有一个 html 文件</p>
<p>因此，如果要使用 history 模式，就需要在服务端增加一个覆盖所有情况的候选资源，如果 URL 匹配不到任何静态资源，则应返回单页应用的 html 文件</p>
<h3 id="各自的优缺点"><a href="#各自的优缺点" class="headerlink" title="各自的优缺点"></a>各自的优缺点</h3><div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>hash</th>
<th>history</th>
</tr>
</thead>
<tbody>
<tr>
<td>观赏性</td>
<td>丑</td>
<td>美</td>
</tr>
<tr>
<td>兼容性</td>
<td>&gt;IE8</td>
<td>&gt;IE10</td>
</tr>
<tr>
<td>其他</td>
<td>锚点功能失效，相同 hash 值不触发动作</td>
<td>需要服务端配合，相同 path 值也可以通过 pushState 触发动作</td>
</tr>
</tbody>
</table>
</div>
<h1 id="函数防抖与函数节流"><a href="#函数防抖与函数节流" class="headerlink" title="函数防抖与函数节流"></a>函数防抖与函数节流</h1><h2 id="函数防抖"><a href="#函数防抖" class="headerlink" title="函数防抖"></a>函数防抖</h2><p>等了一段时间，没有新的人上车了再发车：任务频繁触发的情况下，只有任务触发的间隔超过指定间隔的时候，任务才会执行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> debounce = <span class="function">(<span class="params">fn, delay = <span class="number">300</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    clearTimeout(timer)</span><br><span class="line">    timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">    &#125;, delay)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="函数节流"><a href="#函数节流" class="headerlink" title="函数节流"></a>函数节流</h2><p>冷却时间：指定时间间隔内只会执行一次任务</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> throttle = <span class="function">(<span class="params">fn, interval = <span class="number">300</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> canRun = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!canRun) <span class="keyword">return</span></span><br><span class="line">    canRun = <span class="literal">false</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">      canRun = <span class="literal">true</span></span><br><span class="line">    &#125;, interval)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="如何用正则实现-trim"><a href="#如何用正则实现-trim" class="headerlink" title="如何用正则实现 trim()"></a>如何用正则实现 <code>trim()</code></h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> trim = <span class="function">(<span class="params">string</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> string.replace(<span class="regexp">/^\s+|\s+$/g</span>, <span class="string">''</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="对象和数组的深拷贝"><a href="#对象和数组的深拷贝" class="headerlink" title="对象和数组的深拷贝"></a>对象和数组的深拷贝</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  a: <span class="number">100</span>,</span><br><span class="line">  b: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>],</span><br><span class="line">  c: &#123;</span><br><span class="line">    x: <span class="number">10</span></span><br><span class="line">  &#125;,</span><br><span class="line">  d: <span class="regexp">/^\d+$/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="直接赋值"><a href="#直接赋值" class="headerlink" title="直接赋值"></a>直接赋值</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj2 = obj1</span><br></pre></td></tr></table></figure>
<p>当改变 <code>obj1</code> 的时候，<code>obj2</code> 会跟着改变，这是直接赋值，不属于深/浅克隆</p>
<h2 id="浅克隆"><a href="#浅克隆" class="headerlink" title="浅克隆"></a>浅克隆</h2><blockquote>
<p>只克隆第一层</p>
</blockquote>
<h3 id="手动实现"><a href="#手动实现" class="headerlink" title="手动实现"></a>手动实现</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj2 = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="keyword">if</span>(!obj.hasOwnProperty(key)) <span class="keyword">continue</span> <span class="comment">// 这里也可以用 break，因为到这一步基本就已经到原型的属性了，可以直接跳出循环</span></span><br><span class="line">  obj2[key] = obj[key]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Object-assign"><a href="#Object-assign" class="headerlink" title="Object.assign"></a>Object.assign</h3><p>他拷贝的是对象属性的引用，而不是对象本身</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj2 = <span class="built_in">Object</span>.assign(&#123;&#125;, obj)</span><br></pre></td></tr></table></figure>
<h3 id="展开运算符"><a href="#展开运算符" class="headerlink" title="展开运算符"></a>展开运算符</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj2 = &#123; ...obj &#125;</span><br></pre></td></tr></table></figure>
<h3 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> newArr = arr.concat()</span><br></pre></td></tr></table></figure>
<h3 id="slice"><a href="#slice" class="headerlink" title="slice"></a>slice</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> newArr = arr.slice()</span><br></pre></td></tr></table></figure>
<h2 id="深克隆"><a href="#深克隆" class="headerlink" title="深克隆"></a>深克隆</h2><blockquote>
<p>每一层都克隆</p>
</blockquote>
<h3 id="简易版的深拷贝"><a href="#简易版的深拷贝" class="headerlink" title="简易版的深拷贝"></a>简易版的深拷贝</h3><p>最最最简单的深拷贝可以这样写：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj2 = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(obj))</span><br></pre></td></tr></table></figure>
<p>但是在有些时候是会出现问题的：</p>
<ol>
<li>循环引用</li>
<li>无法处理 RegExp、Date、Set、Map、Function 等</li>
</ol>
<p>也可以用 <code>lodash</code> 之类的库，当然也可以手写一个简易版的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> target === <span class="string">'object'</span> &amp;&amp; target !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> cloneTarget = <span class="built_in">Array</span>.isArray(target) ? [] : &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> target) &#123;</span><br><span class="line">      <span class="keyword">if</span> (target.hasOwnProperty(prop)) &#123;</span><br><span class="line">        cloneTarget[prop] = deepClone(target[prop])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cloneTarget</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="解决循环引用问题"><a href="#解决循环引用问题" class="headerlink" title="解决循环引用问题"></a>解决循环引用问题</h3><p>思路：创建一个 Map，将已经拷贝过的对象记录下来，如果发现已经拷贝过，就直接返回他</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isObject = <span class="function">(<span class="params">target</span>) =&gt;</span> (<span class="keyword">typeof</span> target === <span class="string">'object'</span> || <span class="keyword">typeof</span> target === <span class="string">'function'</span>) &amp;&amp; target !== <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> deepClone = <span class="function">(<span class="params">target, map = <span class="keyword">new</span> weakMap(</span>)) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (map.get(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (isObject(target)) &#123;</span><br><span class="line">    map.set(target, <span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">const</span> cloneTarget = <span class="built_in">Array</span>.isArray(target) ? [] : &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> target) &#123;</span><br><span class="line">      <span class="keyword">if</span> (target.hasOwnProperty(prop)) &#123;</span><br><span class="line">        cloneTarget[prop] = deepClone(target[prop], map)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cloneTarget</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果使用 Map，那么 map 的 key 将会与 map 形成强引用，如果强引用一直存在，那么对象将无法被回收；使用 WeakMap 可以构造一种弱引用（一个对象若只被弱引用所引用，则被认为是不可访问（或弱可访问）的，并因此可能在任何时刻被回收），WeakMap 的 Key 必须是对象，而值可以是任意的。</p>
<h3 id="拷贝特殊对象"><a href="#拷贝特殊对象" class="headerlink" title="拷贝特殊对象"></a>拷贝特殊对象</h3><h4 id="可继续遍历"><a href="#可继续遍历" class="headerlink" title="可继续遍历"></a>可继续遍历</h4><p>比如 Map、Set、Array、Object、Arguments：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getType = <span class="built_in">Object</span>.prototype.toString.call</span><br><span class="line"><span class="keyword">const</span> isObject = <span class="function">(<span class="params">target</span>) =&gt;</span> (<span class="keyword">typeof</span> target === <span class="string">'object'</span> || <span class="keyword">typeof</span> target === <span class="string">'function'</span>) &amp;&amp; target !== <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> canTraverse = &#123;</span><br><span class="line">  <span class="string">'[object Map]'</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">'[object Set]'</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">'[object Array]'</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">'[object Object]'</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">'[object Arguments]'</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> deepClone = <span class="function">(<span class="params">target, map = <span class="keyword">new</span> <span class="built_in">WeakMap</span>(</span>)) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!isObject(target)) <span class="keyword">return</span> target</span><br><span class="line">  <span class="keyword">let</span> type = getType(target)</span><br><span class="line">  <span class="keyword">let</span> cloneTarget</span><br><span class="line">  <span class="keyword">if</span> (!canTraverse[type]) &#123;</span><br><span class="line">    <span class="comment">// 处理不可遍历对象</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    cloneTarget = <span class="keyword">new</span> target.constructor()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (map.get(target)) <span class="keyword">return</span> target</span><br><span class="line">  map.set(target, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">'[object Map]'</span>) &#123;</span><br><span class="line">    target.forEach(<span class="function">(<span class="params">item, key</span>) =&gt;</span> &#123;</span><br><span class="line">      cloneTarget.set(deepClone(key), deepClone(item))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">'[object Set]'</span>) &#123;</span><br><span class="line">    target.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      target.add(deepClone(item))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理 Object 和 Array</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> target) &#123;</span><br><span class="line">    <span class="keyword">if</span> (target.hasOwnProperty(prop)) &#123;</span><br><span class="line">      cloneTarget[prop] = deepClone(target[prop])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cloneTarget</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="不可遍历"><a href="#不可遍历" class="headerlink" title="不可遍历"></a>不可遍历</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> boolTag = <span class="string">'[object Boolean]'</span>;</span><br><span class="line"><span class="keyword">const</span> numberTag = <span class="string">'[object Number]'</span>;</span><br><span class="line"><span class="keyword">const</span> stringTag = <span class="string">'[object String]'</span>;</span><br><span class="line"><span class="keyword">const</span> dateTag = <span class="string">'[object Date]'</span>;</span><br><span class="line"><span class="keyword">const</span> errorTag = <span class="string">'[object Error]'</span>;</span><br><span class="line"><span class="keyword">const</span> regExpTag = <span class="string">'[object RegExp]'</span>;</span><br><span class="line"><span class="keyword">const</span> funcTag = <span class="string">'[object Function]'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleRegExp = <span class="function">(<span class="params">target</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;source, flags&#125; = target</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> target.constructor(source, flags)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要区分处理箭头函数和普通函数，因为普通函数是 Function 的实例，而箭头函数不是任何类的实例</span></span><br><span class="line"><span class="keyword">const</span> handleFunc = <span class="function">(<span class="params">func</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 箭头函数返回自身</span></span><br><span class="line">  <span class="keyword">if</span> (!func.prototype) <span class="keyword">return</span> func</span><br><span class="line">  <span class="keyword">const</span> bodyReg = <span class="regexp">/(?&lt;=&#123;)(.|\n)(?=&#125;)/m</span></span><br><span class="line">  <span class="keyword">const</span> paramReg = <span class="regexp">/(?&lt;=\().+(?=\)\s*&#123;)/</span></span><br><span class="line">  <span class="keyword">const</span> funcString = func.toString()</span><br><span class="line">  <span class="keyword">const</span> param = paramReg.exec(funcString)</span><br><span class="line">  <span class="keyword">const</span> body = bodyReg.exec(funcString)</span><br><span class="line">  <span class="keyword">if</span> (!body) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  <span class="keyword">if</span> (param) &#123;</span><br><span class="line">    <span class="keyword">const</span> paramArr = param[<span class="number">0</span>].slice(<span class="string">','</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Function</span>(...param, body[<span class="number">0</span>])</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Function</span>(body[<span class="number">0</span>])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleNotTraverse = <span class="function">(<span class="params">target, tag</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">constructor</span> = target.<span class="keyword">constructor</span></span><br><span class="line">  switch (tag) &#123;</span><br><span class="line">    <span class="keyword">case</span> boolTag:</span><br><span class="line">      <span class="comment">// 因为用 new Boolean 创造出来的对象有问题</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Object</span>(<span class="built_in">Boolean</span>.prototype.valueOf.call(target))</span><br><span class="line">    <span class="keyword">case</span> numberTag:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Object</span>(<span class="built_in">Number</span>.prototype.valueOf.call(target))</span><br><span class="line">    <span class="keyword">case</span> stringTag:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Object</span>(<span class="built_in">String</span>.prototype.valueOf.call(target))</span><br><span class="line">    <span class="keyword">case</span> errorTag:</span><br><span class="line">    <span class="keyword">case</span> dateTag:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">constructor</span>(target)</span><br><span class="line">    case regExpTag:</span><br><span class="line">      return handleRegExp(target)</span><br><span class="line">    case funcTag:</span><br><span class="line">      return handleFunc(target)</span><br><span class="line">    default:</span><br><span class="line">      return new <span class="keyword">constructor</span>(target)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getType = <span class="function"><span class="params">target</span> =&gt;</span> <span class="built_in">Object</span>.prototype.toString.call(target).match(<span class="regexp">/\[object (.*?)\]/</span>)[<span class="number">1</span>].toLowerCase()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isObject = <span class="function"><span class="params">target</span> =&gt;</span> (<span class="keyword">typeof</span> target === <span class="string">'object'</span> || <span class="keyword">typeof</span> target === <span class="string">'function'</span>) &amp;&amp; target !== <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> canTraverse = &#123;</span><br><span class="line">  <span class="string">'map'</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">'set'</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">'array'</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">'object'</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">'arguments'</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleRegExp = <span class="function"><span class="params">target</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;source,flags&#125; = target</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> target.constructor(source, flags)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleFunc = <span class="function"><span class="params">func</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!func.prototype) <span class="keyword">return</span> func</span><br><span class="line">  <span class="keyword">const</span> bodyReg = <span class="regexp">/(?&lt;=&#123;)(.|\n)(?=&#125;)/m</span></span><br><span class="line">  <span class="keyword">const</span> paramReg = <span class="regexp">/(?&lt;=\().+(?=\)\s+&#123;)/</span></span><br><span class="line">  <span class="keyword">const</span> funcString = func.toString()</span><br><span class="line">  <span class="keyword">const</span> param = paramReg.exec(funcString)</span><br><span class="line">  <span class="keyword">const</span> body = bodyReg.exec(funcString)</span><br><span class="line">  <span class="keyword">if</span> (!body) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  <span class="keyword">if</span> (param) &#123;</span><br><span class="line">    <span class="keyword">const</span> paramArr = param[<span class="number">0</span>].split(<span class="string">','</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Function</span>(...paramArr, body[<span class="number">0</span>])</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Function</span>(body[<span class="number">0</span>])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleNotTraverse = <span class="function">(<span class="params">target, type</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">constructor</span> = target.<span class="keyword">constructor</span></span><br><span class="line">  switch (type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'boolean'</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Object</span>(<span class="built_in">Boolean</span>.prototype.valueOf.call(target))</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'number'</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Object</span>(<span class="built_in">Number</span>.prototype.valueOf.call(target))</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'string'</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Object</span>(<span class="built_in">String</span>.prototype.valueOf.call(target))</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'symbol'</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Object</span>(<span class="built_in">Symbol</span>.prototype.valueOf.call(target))</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'error'</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'date'</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">constructor</span>(target)</span><br><span class="line">    case 'regexp':</span><br><span class="line">      return handleRegExp(target)</span><br><span class="line">    case 'function':</span><br><span class="line">      return handleFunc(target)</span><br><span class="line">    default:</span><br><span class="line">      return new <span class="keyword">constructor</span>(target)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const deepClone = (target, map = new WeakMap()) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!isObject(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> type = getType(target)</span><br><span class="line">  <span class="keyword">let</span> cloneTarget</span><br><span class="line">  <span class="keyword">if</span> (!canTraverse[type]) &#123;</span><br><span class="line">    <span class="keyword">return</span> handleNotTraverse(target, type)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    cloneTarget = <span class="keyword">new</span> target.constructor()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (map.get(target)) <span class="keyword">return</span> target</span><br><span class="line">  map.set(target, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">'map'</span>) &#123;</span><br><span class="line">    target.forEach(<span class="function">(<span class="params">item, key</span>) =&gt;</span> &#123;</span><br><span class="line">      cloneTarget.set(deepClone(key, map), deepClone(item, map))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">'set'</span>) &#123;</span><br><span class="line">    target.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      cloneTarget.add(deepClone(item, map))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> target) &#123;</span><br><span class="line">    <span class="keyword">if</span> (target.hasOwnProperty(prop)) &#123;</span><br><span class="line">      cloneTarget[prop] = deepClone(target[prop], map)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cloneTarget</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="关于堆栈内存和闭包"><a href="#关于堆栈内存和闭包" class="headerlink" title="关于堆栈内存和闭包"></a>关于堆栈内存和闭包</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example 1</span></span><br><span class="line"><span class="keyword">let</span> a = &#123;&#125;,</span><br><span class="line">    b = <span class="string">'0'</span>,</span><br><span class="line">    c = <span class="number">0</span></span><br><span class="line">a[b]= <span class="string">'Harvey'</span></span><br><span class="line">a[c] = <span class="string">'Zhang'</span></span><br><span class="line"><span class="built_in">console</span>.log(a[b]) <span class="comment">// =&gt; 'Zhang'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// example 2</span></span><br><span class="line"><span class="keyword">let</span> a = &#123;&#125;,</span><br><span class="line">    b = <span class="built_in">Symbol</span>(<span class="string">'1'</span>),</span><br><span class="line">    c = <span class="built_in">Symbol</span>(<span class="string">'1'</span>)</span><br><span class="line">a[b] = <span class="string">'Harvey'</span></span><br><span class="line">a[c] = <span class="string">'Zhang'</span></span><br><span class="line"><span class="built_in">console</span>.log(a[b]) <span class="comment">// =&gt; 'Harvey'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// example 3</span></span><br><span class="line"><span class="keyword">let</span> a = &#123;&#125;,</span><br><span class="line">    b = &#123; <span class="attr">n</span>: <span class="string">'1'</span> &#125;,</span><br><span class="line">    c = &#123; <span class="attr">m</span>: <span class="string">'2'</span> &#125;</span><br><span class="line">a[b] = <span class="string">'Harvey'</span></span><br><span class="line">a[c] = <span class="string">'Zhang'</span></span><br><span class="line"><span class="built_in">console</span>.log(a[b]) <span class="comment">// =&gt; 'Zhang'</span></span><br><span class="line"><span class="comment">// 所有的引用类型存的时候都会被转换成字符串，而 object 转换成字符串的结果都是 '[object Object]'</span></span><br></pre></td></tr></table></figure>
<div class="note warning">
            <p>堆：存储引用类型值的空间；<br>栈：存储基本类型值和执行代码的环境；浏览器加载页面就会形成栈内存，当执行函数的时候，都会形成一个新的执行上下文（Execution Context Stack），压入栈中执行</p>
          </div>
<p>闭包的作用 1：保存——保存私有变量，不被销毁</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = (<span class="function"><span class="keyword">function</span> (<span class="params">i</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(i *= <span class="number">2</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(<span class="number">2</span>) <span class="comment">// =&gt; var test = AAAFFF111</span></span><br><span class="line">test(<span class="number">5</span>) <span class="comment">// =&gt; '4'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌─────────────────────────────────────────────────</span><br><span class="line">│ 堆内存：地址 AAAFFF111</span><br><span class="line">│ 作为函数，存储代码（字符串）</span><br><span class="line">│ 作为对象，存储键值对（prototype、length、name ...）</span><br><span class="line">└─────────────────────────────────────────────────</span><br><span class="line"></span><br><span class="line">┌─────────────────────────────────────────────────</span><br><span class="line">│ 栈内存：执行上下文 1，不销毁，因为 i 被占着</span><br><span class="line">│ i &#x3D; 2</span><br><span class="line">│ return AAAFFF111</span><br><span class="line">└─────────────────────────────────────────────────</span><br><span class="line">    ↑</span><br><span class="line">    | 上级作用域</span><br><span class="line">    |</span><br><span class="line">┌─────────────────────────────────────────────────</span><br><span class="line">│ 栈内存：执行上下文 2，执行完之后销毁</span><br><span class="line">│ alert(i *&#x3D; 2)</span><br><span class="line">└─────────────────────────────────────────────────</span><br></pre></td></tr></table></figure>
<p>闭包的作用 2：保护——修改自己的私有变量，不会影响外面的东西</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">0</span>,</span><br><span class="line">    b = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params">a</span>) </span>&#123; <span class="comment">// 全局 A = AAAFFF000</span></span><br><span class="line">  A = <span class="function"><span class="keyword">function</span> (<span class="params">b</span>) </span>&#123;</span><br><span class="line">    alert(a + b++)</span><br><span class="line">  &#125;</span><br><span class="line">  alert(a++)</span><br><span class="line">&#125;</span><br><span class="line">A(<span class="number">1</span>) <span class="comment">// =&gt; '1', a = 2</span></span><br><span class="line">A(<span class="number">2</span>) <span class="comment">// =&gt; '4', b = 3</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">┌─────────────────────────────────────────────────</span><br><span class="line">│ Global Object</span><br><span class="line">| a &#x3D; 0</span><br><span class="line">| b &#x3D; 0</span><br><span class="line">| A &#x3D; AAAFFF000</span><br><span class="line">└─────────────────────────────────────────────────</span><br><span class="line"></span><br><span class="line">┌─────────────────────────────────────────────────</span><br><span class="line">│ 堆内存：AAAFFF000</span><br><span class="line">│ &#96;A &#x3D; function(b) &#123; alert(a + b++) &#125;; alert(a++)&#96;</span><br><span class="line">└─────────────────────────────────────────────────</span><br><span class="line">┌─────────────────────────────────────────────────</span><br><span class="line">│ 堆内存：BBBFFF000</span><br><span class="line">│ &#96;alert(a + b++)&#96;</span><br><span class="line">└─────────────────────────────────────────────────</span><br><span class="line"></span><br><span class="line">┌─────────────────────────────────────────────────</span><br><span class="line">│ 栈内存：A(1) ECStack，因为 BBBFFF000 被全局 A 占用了，所以不销毁</span><br><span class="line">│ a &#x3D; 1</span><br><span class="line">| A &#x3D; BBBFFF000</span><br><span class="line">| alert(a++)</span><br><span class="line">└─────────────────────────────────────────────────</span><br><span class="line">┌─────────────────────────────────────────────────</span><br><span class="line">│ 栈内存：A(2) ECStack，没有被占用的，所以销毁</span><br><span class="line">│ b &#x3D; 2</span><br><span class="line">| alert(a + b++)</span><br><span class="line">└─────────────────────────────────────────────────</span><br></pre></td></tr></table></figure>
<h1 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 存在变量提升</span></span><br><span class="line">  getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line">Foo.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line">Foo.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 存在变量提升</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">4</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 存在变量提升</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">5</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Foo.getName() <span class="comment">// 2</span></span><br><span class="line">getName() <span class="comment">// 4</span></span><br><span class="line">Foo().getName() <span class="comment">// Foo() 作为普通函数执行，改变了全局的 getName() 为 1，返回 this（为 window）</span></span><br><span class="line">getName() <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">new</span> Foo.getName() <span class="comment">// 前面是无参数 new（优先级18），后面是成员访问（优先级19），先执行成员访问，获取 Foo.getName()，为 2，再 new（相当于普通函数执行）</span></span><br><span class="line"><span class="keyword">new</span> Foo().getName() <span class="comment">// 前面是有参数 new（优先级19），后面是成员访问（优先级19），先 new（创建实例），getName 是原型上的 getName，3</span></span><br><span class="line"><span class="keyword">new</span> <span class="keyword">new</span> Foo().getName() <span class="comment">// 先 new（创建实例 xxx），变为 new xxx.getName()，再算成员访问（原型上的方法），为 3，再 new</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">┌─────────────────────────────────────────────────</span><br><span class="line">│ 堆内存：AAAFFF000</span><br><span class="line">| 代码字符串</span><br><span class="line">| getName: fun -&gt; 2</span><br><span class="line">| prototype: BBBFFF000</span><br><span class="line">└─────────────────────────────────────────────────</span><br><span class="line">┌─────────────────────────────────────────────────</span><br><span class="line">│ 堆内存：BBBFFF000</span><br><span class="line">│ constructor: Foo</span><br><span class="line">| getName: func -&gt; 3</span><br><span class="line">└─────────────────────────────────────────────────</span><br><span class="line"></span><br><span class="line">┌─────────────────────────────────────────────────</span><br><span class="line">│ 变量提升阶段</span><br><span class="line">| Foo &#x3D; AAAFFF000，声明并定义</span><br><span class="line">│ getName &#x3D; func -&gt; 5，var 声明，之后在 function 赋值</span><br><span class="line">└─────────────────────────────────────────────────</span><br><span class="line">┌─────────────────────────────────────────────────</span><br><span class="line">│ 代码执行阶段</span><br><span class="line">| getName &#x3D; func -&gt; 4，在 var 处赋值</span><br><span class="line">└─────────────────────────────────────────────────</span><br></pre></td></tr></table></figure>
<h1 id="parseUrl-函数"><a href="#parseUrl-函数" class="headerlink" title="parseUrl 函数"></a>parseUrl 函数</h1><p>可以用 <code>new URL</code> API 或者创建一个 <code>&lt;a&gt;</code> 标签的，并获取他的属性：</p>
<p>new URL 在 IE 上兼容性不是很好，但是 Node 也支持这个 API。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> parseUrl = <span class="function"><span class="params">source</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="keyword">new</span> URL(source)</span><br><span class="line">  <span class="keyword">const</span> query = &#123;&#125;</span><br><span class="line">  <span class="keyword">const</span> params = url.search.replace(<span class="regexp">/^\?/</span>, <span class="string">''</span>).split(<span class="string">'&amp;'</span>)</span><br><span class="line">  params.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> param = item.split(<span class="string">'='</span>)</span><br><span class="line">    query[param[<span class="number">0</span>]] = param[<span class="number">1</span>]</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    protocol: url.protocol.replace(<span class="string">':'</span>, <span class="string">''</span>),</span><br><span class="line">    host: url.host,</span><br><span class="line">    path: url.pathname,</span><br><span class="line">    query: query,</span><br><span class="line">    hash: url.hash.replace(<span class="string">'#'</span>, <span class="string">''</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(parseUrl(<span class="string">"http://www.xiyanghui.com/product/list?id=123456&amp;sort=discount#title"</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> parseUrl = <span class="function"><span class="params">source</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>)</span><br><span class="line">  a.href = source</span><br><span class="line">  <span class="comment">// 下面的内容是一样的</span></span><br><span class="line">  <span class="keyword">const</span> query = &#123;&#125;</span><br><span class="line">  <span class="keyword">const</span> params = a.search.replace(<span class="regexp">/^\?/</span>,<span class="string">''</span>).split(<span class="string">'&amp;'</span>);</span><br><span class="line">  params.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> param = item.split(<span class="string">'='</span>)</span><br><span class="line">    query[param[<span class="number">0</span>]] = param[<span class="number">1</span>]</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    protocol: a.protocol.replace(<span class="string">':'</span>,<span class="string">''</span>),</span><br><span class="line">    host: a.host,</span><br><span class="line">    path: a.pathname,</span><br><span class="line">    query: query,</span><br><span class="line">    hash: a.hash.replace(<span class="string">'#'</span>,<span class="string">''</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(parseUrl(<span class="string">"http://www.xiyanghui.com/product/list?id=123456&amp;sort=discount#title"</span>))</span><br></pre></td></tr></table></figure>
<h1 id="EventLoop"><a href="#EventLoop" class="headerlink" title="EventLoop"></a>EventLoop</h1><h2 id="浏览器中的-EventLoop"><a href="#浏览器中的-EventLoop" class="headerlink" title="浏览器中的 EventLoop"></a>浏览器中的 EventLoop</h2><p>浏览器中的 EventLoop 有 2 个阶段：<strong>宏任务</strong> 和 <strong>微任务</strong></p>
<ol>
<li>第一个 <strong>宏任务</strong>：整段脚本。执行过程中的 <strong>同步代码</strong> 直接执行，<strong>宏任务</strong> 进入宏任务队列，<strong>微任务</strong> 进入微任务队列</li>
<li>当前 <strong>宏任务</strong> 执行完出队，检查 <strong>微任务</strong> 队列，若有则依次执行，直至微任务队列为空</li>
<li>执行浏览器 <strong>UI 线程</strong> 的渲染工作</li>
<li>检查是否有 <strong>Web worker</strong> 任务，有则执行</li>
<li>执行队首新的 <strong>宏任务</strong>，回到 2 循环至宏任务队列为空</li>
</ol>
<h3 id="一些例子"><a href="#一些例子" class="headerlink" title="一些例子"></a>一些例子</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'async1 start'</span>)  <span class="comment">// 2</span></span><br><span class="line">  <span class="keyword">await</span> async2() <span class="comment">// -&gt; 执行 async2 并等待返回结果</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'async1 end'</span>) <span class="comment">// 6 -&gt; 有的浏览器会先执行 then 的，而不是按入栈出栈的先后顺序</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'async2'</span>)  <span class="comment">// 3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'script start'</span>)  <span class="comment">// 1</span></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'setTimeout'</span>)  <span class="comment">// 8</span></span><br><span class="line">&#125;)</span><br><span class="line">async1()</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise1'</span>) <span class="comment">// 4</span></span><br><span class="line">  resolve()</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise2'</span>) <span class="comment">// 7</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'script end'</span>) <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
<h2 id="Node-js-中的-EventLoop"><a href="#Node-js-中的-EventLoop" class="headerlink" title="Node.js 中的 EventLoop"></a>Node.js 中的 EventLoop</h2><p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e96b8587ad911d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p>
<h3 id="三大关键阶段"><a href="#三大关键阶段" class="headerlink" title="三大关键阶段"></a>三大关键阶段</h3><ol>
<li><strong>timer</strong>：执行定时器回调阶段，检查定时器（<code>setTimeout</code> <code>setInterval</code>），如果到了时间就执行回调。</li>
<li><strong>poll</strong>：轮询阶段，当文件 I/O、网络 I/O 等一步操作执行完之后，通过 <code>data</code> <code>connect</code> 等事件来通知 JS 主线程，使得时间循环到达 poll 阶段：<ul>
<li>如果当前已经存在定时器，且定时器到时间了，拿出来执行，eventLoop 回到 timer 阶段</li>
<li>如果没有定时器，就去看回调函数队列<ul>
<li>如果队列不为空，拿出队列中的方法依次执行</li>
<li>如果队列为空，检查是否有 <code>setImmediate</code><ul>
<li>有则前往 check 阶段</li>
<li>没有则继续等待，等待 callback 加入队列，加入后会立即执行；一定时间后自动进入 check 阶段</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>check</strong>：直接执行 <code>setImmediate</code></li>
</ol>
<ul>
<li><code>setTimeout</code> -&gt; timers</li>
<li><code>setImmediate</code> -&gt; check</li>
<li><code>nextTick</code> -&gt; 当前阶段的后面</li>
<li><code>promise.then</code> -&gt; 看他是通过什么实现的，如果是用 <code>nextTick</code> 实现的，就当 <code>nextTick</code> 看，当 <code>resolve</code> 的时候放在当前阶段的后面</li>
</ul>
<h3 id="一些例子-1"><a href="#一些例子-1" class="headerlink" title="一些例子"></a>一些例子</h3><p>注意：有可能先执行 JS 代码，也有可能先开启 EventLoop，因为进程开启都需要时间。</p>
<p>比如当执行：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(fn, <span class="number">100</span>)</span><br><span class="line">setImmediate(fn2)</span><br></pre></td></tr></table></figure>
<p><strong><code>fn</code> 放到一个 timers 的一个数组中</strong><br>V<br><strong>进入 poll 阶段进行等待，同时看时间</strong><br>V<br><strong>进入 check 阶段</strong><br>允许在 poll 阶段空闲的时候立即执行一些函数，主要是 <code>setImmediate()</code> 里面的，<br>比如如果有 <code>setImmediate(fn2)</code>，则在 poll 中就不等了，直接进入 check，在 check 中执行 <code>fn2</code><br>V<br><strong>进入 timers 阶段，执行 <code>fn</code></strong><br>如果因为之前有 <code>setImmediate()</code> 导致提前进入了下一个循环，而此时 <code>setTimeout</code> 的计时还没到，则此时不执行 <code>fn</code></p>
<p>而有种情况比较特殊：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(fn, <span class="number">0</span>)</span><br><span class="line">setImmediate(fn2)</span><br></pre></td></tr></table></figure>
<p>注意：<br>如果 EventLoop 开启得很快，则此时 timers 中没有 <code>fn</code>；<br>如果 EventLoop 开启得慢，则此时 timers 中有 <code>fn</code>，而如果此时 timers 中有 <code>fn</code>，而且计时已经结束，就马上执行了 <code>fn</code> 再往下走</p>
<p>也就是说因为 EventLoop 有时候开启得快，有时候开启得慢，所以如果一开始就执行上面两句代码，他们的执行先后是不确定的！</p>
<h1 id="JS-垃圾回收"><a href="#JS-垃圾回收" class="headerlink" title="JS 垃圾回收"></a>JS 垃圾回收</h1><h2 id="内存的生命周期"><a href="#内存的生命周期" class="headerlink" title="内存的生命周期"></a>内存的生命周期</h2><p>JS 环境中的内存声明周期由以下三部分组成：</p>
<ol>
<li>内存分配：当我们声明变量、函数、对象的时候，系统会自动分配内存</li>
<li>内存使用：使用变量、函数等</li>
<li>内存回收</li>
</ol>
<h2 id="垃圾回收"><a href="#垃圾回收" class="headerlink" title="垃圾回收"></a>垃圾回收</h2><h3 id="什么是垃圾"><a href="#什么是垃圾" class="headerlink" title="什么是垃圾"></a>什么是垃圾</h3><ul>
<li>没有被引用的，所谓引用就是一个对象拥有访问另一个对象的权限（隐式或显式）</li>
<li>引用的几个对象互相组成环</li>
</ul>
<h3 id="垃圾回收算法"><a href="#垃圾回收算法" class="headerlink" title="垃圾回收算法"></a>垃圾回收算法</h3><h3 id="引用计数法"><a href="#引用计数法" class="headerlink" title="引用计数法"></a>引用计数法</h3><p>每次生成一个新东西，就将被引用的对象的计数 +1，每次删除一个东西，就将被引用的对象计数 -1<br>但是若出现循环引用，则无法回收</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>)</span><br><span class="line">div.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'click'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此处的 div 引用了事件处理函数，事件处理函数也引用了 div，因为 div 可以在事件处理函数中被访问到。</p>
<h3 id="标记清除法"><a href="#标记清除法" class="headerlink" title="标记清除法"></a>标记清除法</h3><ol>
<li>标记所有变量</li>
<li>从根部清除所有能触及的对象的标记</li>
<li>删除掉还有标记的变量</li>
</ol>
<p>解决除了循环引用的问题，因为循环引用的对象无法从全局对象出发再获取到他们的引用。</p>
<h2 id="内存泄漏"><a href="#内存泄漏" class="headerlink" title="内存泄漏"></a>内存泄漏</h2><p>经验法则是，如果连续五次垃圾回收之后，内存占用一次比一次大，就有内存泄漏</p>
<h3 id="常见的内存泄露"><a href="#常见的内存泄露" class="headerlink" title="常见的内存泄露"></a>常见的内存泄露</h3><h4 id="意外的全局变量"><a href="#意外的全局变量" class="headerlink" title="意外的全局变量"></a>意外的全局变量</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  bar1 = <span class="string">'some text'</span> <span class="comment">// 实际上声明了全局变量 window.bar1</span></span><br><span class="line">  <span class="keyword">this</span>.bar2 = <span class="string">'some text'</span> <span class="comment">// 全局变量 window.bar2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="被遗忘的计时器和回调函数"><a href="#被遗忘的计时器和回调函数" class="headerlink" title="被遗忘的计时器和回调函数"></a>被遗忘的计时器和回调函数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> serverData = loadData()</span><br><span class="line">setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> renderer = <span class="built_in">document</span>.getElementById(<span class="string">'renderer'</span>)</span><br><span class="line">  <span class="keyword">if</span>(renderer) &#123;</span><br><span class="line">    renderer.innerHTML = <span class="built_in">JSON</span>.stringify(serverData)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="number">5000</span>)</span><br></pre></td></tr></table></figure>
<p>如果后续移除了 renderer，那么其实计时器已经没用了，但是没有回收计时器的话，计时器仍然后效，他依赖的 serverData 也依然有效</p>
<h4 id="DOM-引用"><a href="#DOM-引用" class="headerlink" title="DOM 引用"></a>DOM 引用</h4><p>前端除了 JS 进程以外，还有 DOM 进程：</p>
<ul>
<li>只使用 <code>div.remove</code> 只是将 <code>div</code> 从页面中删掉，但在内存中还在</li>
<li>只使用 <code>div = null</code>，而没有 <code>remove</code> 的话，<code>div</code> 还在 DOM 中，他就不会被回收</li>
</ul>
<p>此外还有一些特殊情况，比如如果我们引用了一个表格中的 td 元素，一旦在 DOM 中删除了整个表格，我们直观的觉得内存回收应该回收除了被引用的 td 外的其他元素。但是事实上，这个 td 元素是整个表格的一个子元素，并保留对于其父元素的引用。这就会导致对于整个表格，都无法进行内存回收。</p>
<h1 id="与后端进行数据交互的方法"><a href="#与后端进行数据交互的方法" class="headerlink" title="与后端进行数据交互的方法"></a>与后端进行数据交互的方法</h1><h2 id="Form-表单"><a href="#Form-表单" class="headerlink" title="Form 表单"></a>Form 表单</h2><ul>
<li>只支持 GET 和 POST 类型</li>
<li>有问无答</li>
<li>提交后页面会刷新，用户体验不佳</li>
</ul>
<h2 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h2><ul>
<li>支持多种请求方法</li>
<li>XMLHttpRequest</li>
<li>Fetch</li>
<li>POST 请求编码方式<ul>
<li>multipart/formData<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以用</span></span><br><span class="line"><span class="keyword">let</span> formData = <span class="keyword">new</span> FormData()</span><br><span class="line">formData.append(<span class="string">''</span>,<span class="string">''</span>)</span><br><span class="line"><span class="comment">// 也可以直接将 Form 表单的 DOM 对象直接放进去</span></span><br><span class="line"><span class="keyword">let</span> formData = <span class="keyword">new</span> FormData($form)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><ul>
<li>服务器可以主动发起请求</li>
</ul>
<h1 id="关于时间"><a href="#关于时间" class="headerlink" title="关于时间"></a>关于时间</h1><ul>
<li>ISO 8601</li>
<li>Moment.js</li>
<li>Day.js</li>
</ul>
<h1 id="代码题"><a href="#代码题" class="headerlink" title="代码题"></a>代码题</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;<span class="attr">name</span>: <span class="string">'x'</span>&#125;</span><br><span class="line">a.x = a = &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a.x) <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 代码执行分为两步： 1. 确定 a 是什么；2. 执行（从右向左）</span></span><br><span class="line"><span class="comment">// 执行到 a.x 的时候，a 还是原来的地址，但是他右边的 a 已经是新的地址了</span></span><br></pre></td></tr></table></figure>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/hais-notebook/tags/%E5%85%A5%E9%97%A8/" rel="tag"># 入门</a>
              <a href="/hais-notebook/tags/FAQ/" rel="tag"># FAQ</a>
              <a href="/hais-notebook/tags/%E6%94%B6%E9%9B%86/" rel="tag"># 收集</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/hais-notebook/2020/02/04/Others-QA-HtmlCss/" rel="prev" title="FAQs：HTML 与 CSS">
      <i class="fa fa-chevron-left"></i> FAQs：HTML 与 CSS
    </a></div>
      <div class="post-nav-item">
    <a href="/hais-notebook/2020/02/04/CS-Algorithm-QA-UniqueArray/" rel="next" title="算法小问题：数组去重">
      算法小问题：数组去重 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Promise"><span class="nav-number">1.</span> <span class="nav-text">Promise</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Promise-如何消灭回调地狱"><span class="nav-number">1.1.</span> <span class="nav-text">Promise 如何消灭回调地狱</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Promise-怎样实现链式调用的"><span class="nav-number">1.2.</span> <span class="nav-text">Promise 怎样实现链式调用的</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#前端路由"><span class="nav-number">2.</span> <span class="nav-text">前端路由</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Hash-与-History"><span class="nav-number">2.1.</span> <span class="nav-text">Hash 与 History</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hash"><span class="nav-number">2.1.1.</span> <span class="nav-text">Hash</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#基本-API"><span class="nav-number">2.1.1.1.</span> <span class="nav-text">基本 API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#实现一个路由对象"><span class="nav-number">2.1.1.2.</span> <span class="nav-text">实现一个路由对象</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#History"><span class="nav-number">2.1.2.</span> <span class="nav-text">History</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#实现一个路由对象-1"><span class="nav-number">2.1.2.1.</span> <span class="nav-text">实现一个路由对象</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#各自的优缺点及使用场景"><span class="nav-number">2.2.</span> <span class="nav-text">各自的优缺点及使用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#为什么-hash-模式需要服务器端配合？"><span class="nav-number">2.2.1.</span> <span class="nav-text">为什么 hash 模式需要服务器端配合？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#各自的优缺点"><span class="nav-number">2.2.2.</span> <span class="nav-text">各自的优缺点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#函数防抖与函数节流"><span class="nav-number">3.</span> <span class="nav-text">函数防抖与函数节流</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#函数防抖"><span class="nav-number">3.1.</span> <span class="nav-text">函数防抖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#函数节流"><span class="nav-number">3.2.</span> <span class="nav-text">函数节流</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#如何用正则实现-trim"><span class="nav-number">4.</span> <span class="nav-text">如何用正则实现 trim()</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#对象和数组的深拷贝"><span class="nav-number">5.</span> <span class="nav-text">对象和数组的深拷贝</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#直接赋值"><span class="nav-number">5.1.</span> <span class="nav-text">直接赋值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#浅克隆"><span class="nav-number">5.2.</span> <span class="nav-text">浅克隆</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#手动实现"><span class="nav-number">5.2.1.</span> <span class="nav-text">手动实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Object-assign"><span class="nav-number">5.2.2.</span> <span class="nav-text">Object.assign</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#展开运算符"><span class="nav-number">5.2.3.</span> <span class="nav-text">展开运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#concat"><span class="nav-number">5.2.4.</span> <span class="nav-text">concat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#slice"><span class="nav-number">5.2.5.</span> <span class="nav-text">slice</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#深克隆"><span class="nav-number">5.3.</span> <span class="nav-text">深克隆</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#简易版的深拷贝"><span class="nav-number">5.3.1.</span> <span class="nav-text">简易版的深拷贝</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解决循环引用问题"><span class="nav-number">5.3.2.</span> <span class="nav-text">解决循环引用问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#拷贝特殊对象"><span class="nav-number">5.3.3.</span> <span class="nav-text">拷贝特殊对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#可继续遍历"><span class="nav-number">5.3.3.1.</span> <span class="nav-text">可继续遍历</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#不可遍历"><span class="nav-number">5.3.3.2.</span> <span class="nav-text">不可遍历</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#完整代码"><span class="nav-number">5.3.4.</span> <span class="nav-text">完整代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#关于堆栈内存和闭包"><span class="nav-number">6.</span> <span class="nav-text">关于堆栈内存和闭包</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#面向对象"><span class="nav-number">7.</span> <span class="nav-text">面向对象</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#parseUrl-函数"><span class="nav-number">8.</span> <span class="nav-text">parseUrl 函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#EventLoop"><span class="nav-number">9.</span> <span class="nav-text">EventLoop</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#浏览器中的-EventLoop"><span class="nav-number">9.1.</span> <span class="nav-text">浏览器中的 EventLoop</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一些例子"><span class="nav-number">9.1.1.</span> <span class="nav-text">一些例子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Node-js-中的-EventLoop"><span class="nav-number">9.2.</span> <span class="nav-text">Node.js 中的 EventLoop</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#三大关键阶段"><span class="nav-number">9.2.1.</span> <span class="nav-text">三大关键阶段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一些例子-1"><span class="nav-number">9.2.2.</span> <span class="nav-text">一些例子</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#JS-垃圾回收"><span class="nav-number">10.</span> <span class="nav-text">JS 垃圾回收</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#内存的生命周期"><span class="nav-number">10.1.</span> <span class="nav-text">内存的生命周期</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#垃圾回收"><span class="nav-number">10.2.</span> <span class="nav-text">垃圾回收</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是垃圾"><span class="nav-number">10.2.1.</span> <span class="nav-text">什么是垃圾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#垃圾回收算法"><span class="nav-number">10.2.2.</span> <span class="nav-text">垃圾回收算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#引用计数法"><span class="nav-number">10.2.3.</span> <span class="nav-text">引用计数法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#标记清除法"><span class="nav-number">10.2.4.</span> <span class="nav-text">标记清除法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#内存泄漏"><span class="nav-number">10.3.</span> <span class="nav-text">内存泄漏</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常见的内存泄露"><span class="nav-number">10.3.1.</span> <span class="nav-text">常见的内存泄露</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#意外的全局变量"><span class="nav-number">10.3.1.1.</span> <span class="nav-text">意外的全局变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#被遗忘的计时器和回调函数"><span class="nav-number">10.3.1.2.</span> <span class="nav-text">被遗忘的计时器和回调函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DOM-引用"><span class="nav-number">10.3.1.3.</span> <span class="nav-text">DOM 引用</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#与后端进行数据交互的方法"><span class="nav-number">11.</span> <span class="nav-text">与后端进行数据交互的方法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Form-表单"><span class="nav-number">11.1.</span> <span class="nav-text">Form 表单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AJAX"><span class="nav-number">11.2.</span> <span class="nav-text">AJAX</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WebSocket"><span class="nav-number">11.3.</span> <span class="nav-text">WebSocket</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#关于时间"><span class="nav-number">12.</span> <span class="nav-text">关于时间</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#代码题"><span class="nav-number">13.</span> <span class="nav-text">代码题</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Harvey Zhang</p>
  <div class="site-description" itemprop="description">小海的笔记本</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/hais-notebook/archives/">
        
          <span class="site-state-item-count">83</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/hais-notebook/categories/">
          
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/hais-notebook/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Harvey Zhang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.7.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/hais-notebook/lib/anime.min.js"></script>
  <script src="/hais-notebook/lib/velocity/velocity.min.js"></script>
  <script src="/hais-notebook/lib/velocity/velocity.ui.min.js"></script>

<script src="/hais-notebook/js/utils.js"></script>

<script src="/hais-notebook/js/motion.js"></script>


<script src="/hais-notebook/js/schemes/pisces.js"></script>


<script src="/hais-notebook/js/next-boot.js"></script>




  




  
<script src="/hais-notebook/js/local-search.js"></script>













  

  

  

</body>
</html>
